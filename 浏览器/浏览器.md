## 浏览器结构图

- 用户界面
- 浏览器引擎

  用于用户界面和渲染引擎之间传递数据 

- 渲染引擎


## 进程和线程

 > `进程`是操作系统进行资源分配和调度的基本单元，可以申请和拥有计算机资源，进程是程序的基本执行实体
 
 > `线程`是操作系统能够进行运算调度的最小单位，一个进程中可以并发多个线程，每条线程可以执行不同任务

进程间相互独立，通过IPC通信

## 浏览器输入url后，做了些啥

  - DNS域名解析
  - 建立TCP连接
  - 发送HTTP请求
  - 服务器处理请求
  - 返回响应结果
  - 关闭TCP连接
  
  三次握手

  1. 客户端发送第一个报文，进入syn_sent状态，等待服务端响应。
  2. 服务端收到第一个包，返回对应的syn, ack包，进入syn_receive状态
  3. 客户端己收到确认包，发送ack包，客户端和服务端进入established状态。
## 浏览器中的进程

  >多进程结构

  - 浏览器进程
  - 网络进程
  - GPU进程
  - 插件进程 (flash等)
  - 渲染器进程： 每个tab有一个独立的进程（与chrome的进程模式有关，默认为每个tab实例创建一个独立进程）
  - 合成器线程

## 浏览器输入url到获取页面：

  为啥script标签会阻塞渲染，（不知道js中是否会有document.write()方法）

  渲染器主线程

  1. 网络进程获取到数据中，通过IPC将数据传给渲染器进程的主线程
  2. 渲染器进程的主线程将html解析，构造dom树，进行`样式计算`
  3. 根据dom树和生成好的样式生成layout tree
  4. 通过遍历layout tree生成绘制顺序表paint`布局绘制`
  5. 生成layer tree

  合成器线程

  1. 主线程将生成的layer tree和绘制信息传递给合成器线程
  2. 合成器线程按规则进行分图层，将图层分为更小的图块(tiles)传给栅格线程
  3. 合成器线程收集`draw quads`,生成合成器帧`frame`,将该合成器帧通过IPC传给浏览器进程，浏览器进程会通知GPU,进行图像渲染

  栅格线程： 
    
  1. 生成draw quads(图块信息),传回给合成器线程


## 重排，重绘

  - 重排（回流）
    
    改变一个元素的尺寸位置属性时，会重新进行样式计算，布局绘制以及后面的所有流程，这种行为我们称为`重排`，

  - 重绘

    改变元素的颜色属性时，不会触发布局计算，但会进行样式计算和绘制，这种行为我们称为`重绘`

  重排和重绘都会占用主线程，js也会占用主线程

  优化方法：

  - requestAnimationFrame(),划分任务块，在每一帧的绘制前暂停js，归还主线程，绘制结束后继续执行js
  
  - 栅格线程是一个独立的线程， `transform（css属性`主要是运行在合成器线程,不会影响主线程（将position,scale, rotaion等css属性用transform代替